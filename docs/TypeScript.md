# TypeScript 编码规范

统一使用 WebStorm 进行开发，防止使用不同的 IDE 导致编码混乱不统一。

## 一、编程规约

### 一、命名规范

1. `类名`使用 `UpperCamelCase` 风格，必须遵从驼峰形式。

    例如：UserPolo、XmlService
    
2. `方法名、参数名、成员变量、局部变量`都统一使用 `lowerCamelCase` 风格，必须遵从驼峰形式。

    例如：localValue、getHttpMessage()

3. `常量命名全部大写，单词间用下划线隔开`，力求语义表达完整清楚，不要嫌名字长。

    例如：MAX_STOCK_COUNT

4. `抽象类命名`使用 `Abstract` 或 `Base` 开头；`异常类命名`使用 `Exception` 结尾；`测试类命名`以它要测试的类的名称开始，以 `Test` 结尾。

5. `包名`统一使用`小写`，多个单词使用 `-` 分隔。

    例如：user、custom-layout
    
6. 杜绝完全不规范的缩写，避免望文不知义。

7. 为了达到代码自解释的目标，任何自定义编程元素在命名时，使用尽量完整的单词组合来表达其意。

8. 如果`模块、接口、类、方法`使用了`设计模式`，在命名时体现出具体模式。

    > 说明：将设计模式体现在名字中，有利于阅读者快速理解架构设计理念。

    ```TypeScript
    class OrderFactory {} // 工厂模式
    class LoginProxy {} // 代理模式
    class ResourceObserver {} // 观察者模式
    ```

10. `枚举类`名建议带上 `Enum` 后缀，`枚举成员名称`需要`全大写`，`单词间用下划线隔开`。

    ```TypeScript
    class ColorEnum {
        RED, GREEN, RED_GREEN
    }
    ```

### 二、常量定义

1. 常量统一使用硬编码进行初始化。

    ```TypeScript
    class People {
        const TAG = "Pages";
        static TAG = "Pages";
    }
    ```

2. 不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。

    > 说明：大而全的常量类，非得使用查找功能才能定位到修改的常量，不利于理解和维护。

### 三、代码格式

1. 大括号的使用约定。如果是大括号内为空，则简洁地写成 `{}` 即可；如果是非空代码块则：

    1. 左大括号前不换行。
    2. 左大括号后换行。
    3. 右大括号前换行。
    4. 右大括号后还有 else 等代码则不换行；表示终止的右大括号后必须换行。

2. 采用 4 个空格缩进。

3. 注释的双斜线与注释内容之间有且仅有一个空格。

    例如：//[空格]xxxx

4. 单行字符数限制不超过 120 个，超出需要换行（使用 WebStorm 格式化时会自动换行），换行时遵循如下原则：
    1. 第二行相对第一行缩进 4 个空格，从第三行开始，不再继续缩进，参考示例。
    2. 运算符与下文一起换行。
    3. 方法调用的点符号与下文一起换行。
    4. 方法调用时，多个参数，需要换行时，在逗号后进行。
    5. 在括号前不要换行。

    ```TypeScript
    let sb = new StringBuffer();
    // 超过 120 个字符的情况下，换行缩进 4 个空格，点号和方法名称一起换行
    sb.append("zi").append("xin")
       .append("huang")
       .append("huang")
       .append("huang");
 
    method(args1, args2, args3,
       argsX); 
    ```

5.  方法参数在定义和传入时，多个参数逗号后边必须加空格。
    
    ```TypeScript
    method("a", "b", "c"); 
    ```

6. 方法体内的执行语句组、变量的定义语句组、不同的业务逻辑之间或者不同的语义之间插入一个空行。相同业务逻辑和语义之间不需要插入空行。

### 三、OOP 规约 

1. 避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成本，直接用类名来访问即可。

2. 外部正在调用或者二方库依赖的接口，不允许修改方法签名，避免对接口调用方产生影响，可以添加新的方法来实现新的业务逻辑。

3. 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。

4. 类内方法定义顺序依次是：`公有方法或保护方法 > 私有方法 > getter/setter 方法`。

    > 说明：公有方法是类的调用者和维护者最关心的方法，首屏展示最好；保护方法虽然只是子类关心，也可能是“模板设计模式”下的核心方法；而私有方法外部一般不需要特别关心，是一个黑盒实现；因为承载的信息价值较低。

5. 类成员与方法访问控制从严：
    1. 如果不允许外部直接通过 new 来创建对象，那么构造方法必须是 private。
    2. 工具类不允许有 public 构造方法。
    3. 类非 static 成员变量并且与子类共享，必须是 protected。
    4. 类非 static 成员变量并且仅在本类使用，必须是 private。
    5. 类 static 成员变量如果仅在本类使用，必须是 private。
    6. 若是 static 成员变量，必须考虑是否为 const。
    7. 类成员方法只供类内部调用，必须是 private。
    8. 类成员方法只对继承类公开，那么限制为 protected。

    > 说明：任何类、方法、参数、变量，严控访问范围。过于宽泛的访问范围，不利于模块解耦。

### 四、控制语句

1. 在一个 switch 块内，每个 case 要么通过 break/return 等来终止，要么注释说明程序将继续执行到哪一个 case 为止；在一个 switch 块内，都必须包含一个 default 语句并且放在最后，即使它什么代码也没有。

2. 在 if/else/for/while/do 语句中必须使用大括号。即使只有一行代码，避免采用单行的编码方式。
    
    ```TypeScript
    if (condition) statements; // 不要这么写
    
    if (condition) { // 就算一行也要这么写
        statements;
    }
    ```

3. 表达异常的分支时，少用 if-else 方式，这种方式可以改写成：
    
    ```TypeScript
    if (condition) {
     ...
     return obj;
    }
    // 接着写 else 的业务逻辑代码; 
    ```

    如果非得使用 if()...else if()...else...方式表达逻辑，避免后续代码维护困难，请勿超过 3 层。
    
    对于超过 3 层的 if-else 的逻辑判断代码可以使用卫语句、策略模式、状态模式等来实现，其中卫语句示例如下：

    ```TypeScript
    public today() {
        if (isBusy()) {
            System.out.println(“change time.”);
            return;
        }
        if (isFree()) {
            System.out.println(“go to travel.”);
            return;
        }
        System.out.println(“stay at home to learn Alibaba Java Coding Guidelines.”);
        return;
    }
    ```

4. 循环体中的语句要考量性能，以下操作尽量移至循环体外处理，如定义对象、变量、获取数据库连接，进行不必要的 try-catch 操作（这个 try-catch 是否可以移至循环体外）。

### 五、注释规约

1. 类、类属性、类方法的注释必须使用 Javadoc 规范，使用/**内容*/格式，不得使用 // xxx 方式。

    > 说明：在 IDE 编辑窗口中，Javadoc 方式会提示相关注释，生成 Javadoc 可以正确输出相应注释；在 IDE 中，工程调用方法时，不进入方法即可悬浮提示方法、参数、返回值的意义，提高阅读效率。

2. 所有的抽象方法（包括接口中的方法）必须要用 Javadoc 注释、除了返回值、参数、异常说明外，还必须指出该方法做什么事情，实现什么功能。

    > 说明：对子类的实现要求，或者调用注意事项，请一并说明。

3. 方法内部单行注释，在被注释语句上方另起一行，使用//注释。方法内部多行注释使用/* */注释，注意与代码对齐。

4. 所有的枚举类型字段必须要有注释，说明每个数据项的用途。

5. 代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑等的修改。

6. 谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。
   
   > 说明：代码被注释掉有两种可能性：1）后续会恢复此段代码逻辑。2）永久不用。前者如果没有备注信息，难以知晓注释动机。后者建议直接删掉（代码仓库保存了历史代码）。

7. 对于注释的要求：第一、能够准确反应设计思想和代码逻辑；第二、能够描述业务含义，使别的程序员能够迅速了解到代码背后的信息。完全没有注释的大段代码对于阅读者形同天书，注释是给自己看的，即使隔很长时间，也能清晰理解当时的思路；注释也是给继任者看的，使其能够快速接替自己的工作。

8. 特殊注释标记，请注明标记人与标记时间。注意及时处理这些标记，通过标记扫描，经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。

    1. 待办事宜（TODO）:（ 标记人，标记时间，[预计处理时间]）
    2. 错误，不能工作（FIXME）:（标记人，标记时间，[预计处理时间]）

    ```TypeScript
    // TODO 这是一个代办事项
    public isTodo() {
    }
    // FIXME 这是一个错误
    public isTodo() {
    }
    // 在 WebStorm 中 TODO 和 FIXME 会被标记出来，方便处理。
    ```

## 二、异常处理

1. 异常不要用来做流程控制，条件控制，因为异常的处理效率比条件分支低。

2. 对大段代码进行 try-catch，这是不负责任的表现。catch 时请分清稳定代码和非稳定代码，稳定代码指的是无论如何不会出错的代码。对于非稳定代码的 catch 尽可能进行区分异常类型，再做对应的异常处理。

3. 捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。

4. finally 块必须对资源对象、流对象进行关闭，有异常也要做 try-catch。

5. 不能在 finally 块中使用 return，finally 块中的 return 返回后方法结束执行，不会再执行 try 块中的 return 语句。

6. 捕获异常与抛异常，必须是完全匹配，或者捕获异常是抛异常的父类。

    > 说明：如果预期对方抛的是绣球，实际接到的是铅球，就会产生意外情况。

7. 避免出现重复的代码，即 DRY 原则。

    > 说明：随意复制和粘贴代码，必然会导致代码的重复，在以后需要修改时，需要修改所有的副本，容易遗漏。必要时抽取共性方法，或者抽象公共类，甚至是组件化。

# Vue 工程目标

```
├── public                          // 静态页面
├── mock                            // 测试数据与测试逻辑
├── src                             // 主目录
    ├── components                  // 组件
    ├── configs                     // 项目配置
    ├── core                        // 项目框架
    ├── docs                        // 项目文档
    ├── entity                      // 实体
    ├── enum                        // 枚举
    ├── exception                   // 异常处理
    ├── assets                      // 静态资源
        ├── scss                    // 通用 css 样式
        ├── image                   // 图片资源
    ├── router                      // 全局路由配置
    ├── store                       // vuex 配置
    ├── utils                       // 常用工具方法
    ├── views                       // 页面
    ├── App.vue                     // 页面主入口
    ├── main.ts                     // 脚本主入口
├── tests                           // 测试用例
├── .editorconfig                   // 编辑相关配置
├── .npmrc                          // npm 源配置
├── package.json                    // 依赖
├── README.md                       // 项目 readme
├── tsconfig.json                   // ts 配置
├── tslint.json                     // tslint 配置
└── vue.config.js                   // webpack 配置
```
